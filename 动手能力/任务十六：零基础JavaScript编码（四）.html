<!DOCTYPE>
<html>

<head>
    <meta charset="utf-8">
    <title>IFE JavaScript Task 01</title>
    <!-- <script src="task.js"></script> -->
</head>

<body>

    <div>
        <label>城市名称：<input id="aqi-city-input" type="text"></label><br>
        <label>空气质量指数：<input id="aqi-value-input" type="text"></label><br>
        <button id="add-btn">确认添加</button>
        <br /> <br />
        <input type="text" id="cp_code" />
        <button id="cp_btm">确认添加</button>
    </div>
    <table id="aqi-table">
    </table>

    <script>

        var cp_btm = document.getElementById('cp_btm');

        //123M12345678900987654321
        cp_btm.onclick = function () {
            var cp_code = document.getElementById('cp_code').value;
            var modreg = /^([0-9]{3}[P|M|C]{1}[0-9]{20})$/;
            if (!modreg.test(cp_code)) {
                alert("模组数量不能为空")
            } else {
                alert("正确")
            }
        }

        /**
       * aqiData，存储用户输入的空气指数数据
       * 示例格式：
       * aqiData = {
       *    "北京": 90,
       *    "上海": 40
       * };
       */
        /**
         * 从用户输入中获取数据，向aqiData中增加一条数据
         * 然后渲染aqi-list列表，增加新增的数据
         */
        var aqiData = {};
        function addAqiData() {
            var domCity = document.getElementById('aqi-city-input').value;
            var domValue = document.getElementById('aqi-value-input').value;
            aqiData[domCity] = domValue;
            return aqiData;
            console.log(aqiData);
        }

        /**
         * 渲染aqi-table表格
         */
        function renderAqiList() {
            var domTable = document.getElementById('aqi-table');
            domTable.innerHTML = "";        
            for (var domCity in aqiData) {
                if (domTable.children.length === 0) {
                    domTable.innerHTML += "<tr> <td>城市</td> <td>空气质量</td> <td>操作</td> </tr>";
                }                
                var tr = document.createElement('tr');
                var td1 = document.createElement('td');
                td1.innerHTML = domCity;
                tr.appendChild(td1);
                var td2 = document.createElement('td');
                td2.innerHTML = aqiData[domCity];
                tr.appendChild(td2);
                var td3 = document.createElement('td');
                td3.innerHTML = "<button class='del-btn'>删除</button>";
                tr.appendChild(td3);
                domTable.appendChild(tr);            }
           
        }
        /**
         * 点击add-btn时的处理逻辑
         * 获取用户输入，更新数据，并进行页面呈现的更新
         */
        function addBtnHandle() {
            addAqiData();
            renderAqiList();
        }
        /**
         * 点击各个删除按钮的时候的处理逻辑
         * 获取哪个城市数据被删，删除数据，更新表格显示
         */
        function delBtnHandle(target) {
            var tr = target.parentElement.parentElement;
            var strCity = tr.children[0].innerHTML;
            delete aqiData[strCity];
            renderAqiList();
        }

        function init() {
            // 在这下面给add-btn绑定一个点击事件，点击时触发addBtnHandle函数
            var addBtn = document.getElementById('add-btn');
            addBtn.onclick = addBtnHandle
            // 想办法给aqi-table中的所有删除按钮绑定事件，触发delBtnHandle函数
            var delBtn = document.getElementById('aqi-table');
            delBtn.addEventListener('click', function (e) {
                if (e.target && e.target.nodeName === "BUTTON") {
                    delBtnHandle(e.target);
                }
            })
        }

        init();
        /*
        1、js怎样存储对象。
        2、怎么获取对象的键、值对  
        */
    </script>

</body>

</html>